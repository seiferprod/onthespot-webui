<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OnTheSpot - Settings</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <script src="{{ url_for('static', filename='utils.js') }}" defer></script>
    <style>
        .settings-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 15px;
            padding-bottom: 80px;
        }

        .settings-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .settings-header h2 {
            margin: 0;
            font-size: 1.5rem;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .header-actions button {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .btn-save {
            background: linear-gradient(135deg, #1db954, #1ed760);
            color: white;
        }

        .btn-save:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(29, 185, 84, 0.4);
        }

        .btn-logout {
            background: #333;
            color: white;
        }

        .btn-logout:hover {
            background: #444;
        }

        .header-actions img {
            width: 16px;
            height: 16px;
            filter: brightness(0) invert(1);
        }

        .settings-section {
            background: #1a1a1a;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .section-header {
            background: #252525;
            padding: 14px 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            user-select: none;
            transition: background 0.2s;
        }

        .section-header:hover {
            background: #2a2a2a;
        }

        .section-header h3 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            color: #fff;
        }

        .section-toggle {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            transition: transform 0.3s;
        }

        .section-header.collapsed .section-toggle {
            transform: rotate(-90deg);
        }

        .section-content {
            padding: 0;
            max-height: 5000px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .section-content.collapsed {
            max-height: 0;
        }

        .setting-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 18px;
            border-bottom: 1px solid #2a2a2a;
            gap: 15px;
        }

        .setting-row:last-child {
            border-bottom: none;
        }

        .setting-row label:first-child {
            flex: 1;
            font-size: 14px;
            color: #ddd;
            min-width: 0;
        }

        .setting-row input[type="text"],
        .setting-row input[type="password"],
        .setting-row input[type="number"] {
            width: 200px;
            max-width: 50%;
            padding: 8px 12px;
            border: 1px solid #333;
            border-radius: 6px;
            background: #252525;
            color: #fff;
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .setting-row input[type="text"]:focus,
        .setting-row input[type="password"]:focus,
        .setting-row input[type="number"]:focus {
            outline: none;
            border-color: #1db954;
            box-shadow: 0 0 0 3px rgba(29, 185, 84, 0.2);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            min-width: 48px;
            height: 26px;
            flex-shrink: 0;
            cursor: pointer;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #333;
            transition: 0.3s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: #1db954;
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }

        .account-table {
            width: 100%;
            border-collapse: collapse;
        }

        .account-table th {
            text-align: left;
            padding: 12px 15px;
            background: #252525;
            font-size: 12px;
            font-weight: 600;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .account-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #2a2a2a;
            font-size: 14px;
            vertical-align: middle;
        }

        .account-table tr:last-child td {
            border-bottom: none;
        }

        .account-table input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: #1db954;
            cursor: pointer;
        }

        .service-cell {
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .service-cell img {
            width: 20px;
            height: 20px;
        }

        .delete-btn {
            background: transparent;
            border: 1px solid #444;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .delete-btn:hover {
            background: #ff4444;
            border-color: #ff4444;
        }

        .delete-btn img {
            width: 16px;
            height: 16px;
            filter: brightness(0) invert(1);
        }

        .add-account-form {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 15px 18px;
            background: #1f1f1f;
            border-top: 1px solid #2a2a2a;
        }

        .add-account-form select {
            padding: 10px 12px;
            border: 1px solid #333;
            border-radius: 6px;
            background: #252525;
            color: #fff;
            font-size: 14px;
            min-width: 150px;
        }

        .add-account-form input {
            flex: 1;
            min-width: 150px;
            padding: 10px 12px;
            border: 1px solid #333;
            border-radius: 6px;
            background: #252525;
            color: #fff;
            font-size: 14px;
        }

        .add-account-form button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #1db954, #1ed760);
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .add-account-form button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(29, 185, 84, 0.4);
        }

        .login-notice {
            width: 100%;
            padding: 10px;
            background: #2a2a2a;
            border-radius: 6px;
            font-size: 13px;
            color: #f0ad4e;
            display: none;
        }

        .mobile-save-bar {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1a1a1a;
            border-top: 1px solid #333;
            padding: 12px 15px;
            padding-bottom: calc(12px + env(safe-area-inset-bottom, 0));
            z-index: 100;
        }

        .mobile-save-bar button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #1db954, #1ed760);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .table-scroll {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        @media (max-width: 768px) {
            .settings-container {
                padding: 10px;
                padding-bottom: 100px;
            }

            .settings-header {
                position: sticky;
                top: 60px;
                background: #121212;
                padding: 10px 0;
                z-index: 50;
                margin-bottom: 15px;
            }

            .header-actions .btn-save {
                display: none;
            }

            .mobile-save-bar {
                display: block;
            }

            .setting-row {
                padding: 10px 15px;
            }

            .setting-row label:first-child {
                font-size: 13px;
            }

            .setting-row input[type="text"],
            .setting-row input[type="password"],
            .setting-row input[type="number"] {
                width: 120px;
                max-width: 45%;
                padding: 6px 10px;
                font-size: 13px;
            }

            .account-table th:nth-child(4),
            .account-table td:nth-child(4),
            .account-table th:nth-child(7),
            .account-table td:nth-child(7) {
                display: none;
            }

            .service-cell span {
                display: none;
            }

            .add-account-form {
                flex-direction: column;
            }

            .add-account-form select,
            .add-account-form input,
            .add-account-form button {
                width: 100%;
                min-width: 100%;
            }
        }

        @media (max-width: 480px) {
            .account-table th:nth-child(5),
            .account-table td:nth-child(5) {
                display: none;
            }

            .setting-row input[type="text"],
            .setting-row input[type="password"],
            .setting-row input[type="number"] {
                width: 100px;
                max-width: 40%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <ul>
            <li><a href="/search">Search</a></li>
            <li><a href="/download_queue">Downloads</a></li>
            <li><a href="/plex_playlists">Plex</a></li>
            <li><a class="active" href="/settings">Settings</a></li>
            <li><a href="/about">About</a></li>
            <li style="float: right;"><a href="/api/logout" style="color: #e74c3c;">Logout</a></li>
        </ul>
    </div>

    <div class="settings-container">
        <div class="settings-header">
            <h2>Settings</h2>
            <div class="header-actions">
                {% if config.use_webui_login %}
                <button class="btn-logout" onclick="window.location.href='/api/logout';">
                    <img src="/icons/leave.png" alt="Logout">
                    <span>Logout</span>
                </button>
                {% endif %}
                <button class="btn-save" onclick="saveAllSettings()">
                    <img src="/icons/save.png" alt="Save">
                    <span>Save Settings</span>
                </button>
            </div>
        </div>

        <!-- Account Pool Section -->
        <div class="settings-section">
            <div class="section-header" onclick="toggleSection(this)">
                <h3>üîê Account Pool</h3>
                <div class="section-toggle">‚ñº</div>
            </div>
            <div class="section-content">
                <div class="table-scroll">
                    <table class="account-table">
                        <thead>
                            <tr>
                                <th>Active</th>
                                <th>Username</th>
                                <th>Service</th>
                                <th>Type</th>
                                <th>Quality</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for account in account_pool %}
                            <tr>
                                <td>
                                    <input type="radio" name="active_account_number" value="{{ loop.index - 1 }}"
                                        {% if loop.index - 1 == config.active_account_number %} checked {% endif %}>
                                </td>
                                <td style="max-width: 150px; overflow: hidden; text-overflow: ellipsis;">{{ account.username }}</td>
                                <td>
                                    <div class="service-cell">
                                        <img src="/icons/{{ account.service }}.png" alt="{{ account.service }}">
                                        <span>{{ account.service.replace('_', ' ').title() }}</span>
                                    </div>
                                </td>
                                <td>{{ account.account_type|capitalize }}</td>
                                <td>{{ account.bitrate }}</td>
                                <td>{{ account.status|capitalize }}</td>
                                <td>
                                    <button class="delete-btn" onclick="removeAccount('{{ account.uuid }}')">
                                        <img src="/icons/trash.png" alt="Delete">
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="add-account-form">
                    <select id="login_services" onchange="handleServiceChange()">
                        <option value="" disabled>‚îÄ‚îÄ Audio ‚îÄ‚îÄ</option>
                        <option value="apple_music">Apple Music</option>
                        <option value="bandcamp">Bandcamp</option>
                        <option value="deezer">Deezer</option>
                        <option value="qobuz" selected>Qobuz</option>
                        <option value="soundcloud">Soundcloud</option>
                        <option value="spotify">Spotify</option>
                        <option value="tidal">Tidal</option>
                        <option value="youtube_music">Youtube Music</option>
                        <option value="" disabled>‚îÄ‚îÄ Video ‚îÄ‚îÄ</option>
                        <option value="crunchyroll">Crunchyroll</option>
                        <option value="generic">Generic</option>
                    </select>
                    <input type="text" id="login_username" placeholder="Enter your email">
                    <input type="password" id="login_password" placeholder="Enter your password">
                    <button id="login_button" type="button" onclick="addAccount()">Add Account</button>
                    <p id="login_notice" class="login-notice"></p>
                </div>
            </div>
        </div>

        <!-- Web UI Section -->
        <div class="settings-section">
            <div class="section-header" onclick="toggleSection(this)">
                <h3>üåê Web UI</h3>
                <div class="section-toggle">‚ñº</div>
            </div>
            <div class="section-content">
                <div class="setting-row">
                    <label for="use_webui_login">Enable Login Page</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="use_webui_login" {% if config.use_webui_login %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="use_plex_login">Enable Plex Login</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="use_plex_login" {% if config.use_plex_login %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="require_plex_server_access">Require Plex Server Access</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="require_plex_server_access" {% if config.require_plex_server_access is not defined or config.require_plex_server_access %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                    <small style="display: block; color: #666; margin-top: 5px;">Only allow Plex users who have access to your Plex server</small>
                </div>
                <div class="setting-row">
                    <label for="webui_username">Username</label>
                    <input type="text" id="webui_username" value="{{ config.webui_username }}" placeholder="Enter username">
                </div>
                <div class="setting-row">
                    <label for="webui_password">Password</label>
                    <input type="password" id="webui_password" value="{{ config.webui_password }}" placeholder="Enter password">
                </div>
            </div>
        </div>

        <!-- Plex Integration Section -->
        <div class="settings-section">
            <div class="section-header" onclick="toggleSection(this)">
                <h3>üì∫ Plex Integration</h3>
                <div class="section-toggle">‚ñº</div>
            </div>
            <div class="section-content">
                <div style="padding: 10px; margin-bottom: 15px; background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498db; border-radius: 4px;">
                    <strong>Note:</strong> These settings are used for both playlist management <strong>and user authentication</strong>. When "Require Plex Server Access" is enabled, users signing in with Plex must have access to this server.
                </div>
                <div class="setting-row">
                    <label for="plex_server_url">Plex Server URL</label>
                    <input type="text" id="plex_server_url" value="{{ config.plex_server_url or 'http://127.0.0.1:32400' }}" placeholder="http://127.0.0.1:32400">
                    <small style="display: block; color: #666; margin-top: 5px;">URL of your Plex Media Server</small>
                </div>
                <div class="setting-row">
                    <label for="plex_auth_token">X-Plex-Token (Server Owner)</label>
                    <input type="text" id="plex_auth_token" value="{{ config.plex_auth_token or '' }}" placeholder="Enter your X-Plex-Token">
                    <small style="display: block; color: #666; margin-top: 5px;">Server owner's token - used to verify user access and manage playlists</small>
                </div>
                <div class="setting-row">
                    <label for="plex_library_section_id">Library Section ID</label>
                    <input type="text" id="plex_library_section_id" value="{{ config.plex_library_section_id or '' }}" placeholder="Enter library section ID">
                    <small style="display: block; color: #666; margin-top: 5px;">Music library section ID for playlist imports</small>
                </div>
                <div class="setting-row">
                    <label></label>
                    <button onclick="window.location.href='/plex_playlists'" style="padding: 10px 20px; background: linear-gradient(135deg, #e5a00d, #f1c40f); border: none; border-radius: 6px; color: white; font-size: 14px; font-weight: 500; cursor: pointer;">
                        Import Playlists to Plex
                    </button>
                </div>
            </div>
        </div>

        <!-- General Section -->
        <div class="settings-section">
            <div class="section-header" onclick="toggleSection(this)">
                <h3>‚öôÔ∏è General</h3>
                <div class="section-toggle">‚ñº</div>
            </div>
            <div class="section-content">
                <div class="setting-row">
                    <label for="max_search_results">Max Search Results</label>
                    <input type="number" id="max_search_results" value="{{ config.max_search_results }}">
                </div>
                <div class="setting-row">
                    <label for="thumbnail_size">Thumbnail Size (px)</label>
                    <input type="number" id="thumbnail_size" value="{{ config.thumbnail_size }}">
                </div>
                <div class="setting-row">
                    <label for="show_search_thumbnails">Show Thumbnails in Search</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="show_search_thumbnails" {% if config.show_search_thumbnails %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="show_download_thumbnails">Show Thumbnails in Downloads</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="show_download_thumbnails" {% if config.show_download_thumbnails %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="disable_download_popups">Hide Download Popups</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="disable_download_popups" {% if config.disable_download_popups %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="download_locate_btn">Show Locate Button</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="download_locate_btn" {% if config.download_locate_btn %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="download_delete_btn">Show Delete Button</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="download_delete_btn" {% if config.download_delete_btn %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="download_copy_btn">Show Copy Button</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="download_copy_btn" {% if config.download_copy_btn %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="download_open_btn">Show Open Button</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="download_open_btn" {% if config.download_open_btn %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="mirror_spotify_playback">Mirror Spotify Playback</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="mirror_spotify_playback" {% if config.mirror_spotify_playback %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="check_for_updates">Check for Updates</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="check_for_updates" {% if config.check_for_updates %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="close_to_tray">Close to Tray</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="close_to_tray" {% if config.close_to_tray %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="explicit_label">Explicit Label</label>
                    <input type="text" id="explicit_label" value="{{ config.explicit_label }}">
                </div>
                <div class="setting-row">
                    <label for="illegal_character_replacement">Illegal Character Replacement</label>
                    <input type="text" id="illegal_character_replacement" value="{{ config.illegal_character_replacement }}">
                </div>
            </div>
        </div>

        <!-- Download Settings Section -->
        <div class="settings-section">
            <div class="section-header" onclick="toggleSection(this)">
                <h3>‚¨áÔ∏è Download Settings</h3>
                <div class="section-toggle">‚ñº</div>
            </div>
            <div class="section-content">
                <div class="setting-row">
                    <label for="maximum_download_workers">Download Workers</label>
                    <input type="number" id="maximum_download_workers" value="{{ config.maximum_download_workers }}">
                </div>
                <div class="setting-row">
                    <label for="maximum_queue_workers">Queue Workers</label>
                    <input type="number" id="maximum_queue_workers" value="{{ config.maximum_queue_workers }}">
                </div>
                <div class="setting-row">
                    <label for="download_delay">Download Delay (seconds)</label>
                    <input type="number" id="download_delay" value="{{ config.download_delay }}">
                </div>
                <div class="setting-row">
                    <label for="download_chunk_size">Chunk Size (bytes)</label>
                    <input type="number" id="download_chunk_size" value="{{ config.download_chunk_size }}">
                </div>
                <div class="setting-row">
                    <label for="raw_media_download">Skip Media Conversion</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="raw_media_download" {% if config.raw_media_download %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="rotate_active_account_number">Rotate Active Account</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="rotate_active_account_number" {% if config.rotate_active_account_number %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="enable_retry_worker">Enable Retry Worker</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="enable_retry_worker" {% if config.enable_retry_worker %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="retry_worker_delay">Retry Delay (minutes)</label>
                    <input type="number" id="retry_worker_delay" value="{{ config.retry_worker_delay }}">
                </div>
                <div class="setting-row">
                    <label for="windows_10_explorer_thumbnails">Old ID3 Format (Win10)</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="windows_10_explorer_thumbnails" {% if config.windows_10_explorer_thumbnails %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Audio Downloads Section -->
        <div class="settings-section">
            <div class="section-header" onclick="toggleSection(this)">
                <h3>üéµ Audio Downloads</h3>
                <div class="section-toggle">‚ñº</div>
            </div>
            <div class="section-content">
                <div class="setting-row">
                    <label for="audio_download_path">Download Path</label>
                    <input type="text" id="audio_download_path" value="{{ config.audio_download_path }}">
                </div>
                <div class="setting-row">
                    <label for="track_file_format">Track File Format</label>
                    <input type="text" id="track_file_format" value="{{ config.track_file_format }}">
                </div>
                <div class="setting-row">
                    <label for="track_path_formatter">Track Path Formatter</label>
                    <input type="text" id="track_path_formatter" value="{{ config.track_path_formatter }}">
                </div>
                <div class="setting-row">
                    <label for="podcast_file_format">Podcast File Format</label>
                    <input type="text" id="podcast_file_format" value="{{ config.podcast_file_format }}">
                </div>
                <div class="setting-row">
                    <label for="podcast_path_formatter">Podcast Path Formatter</label>
                    <input type="text" id="podcast_path_formatter" value="{{ config.podcast_path_formatter }}">
                </div>
                <div class="setting-row">
                    <label for="use_playlist_path">Use Playlist Path</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="use_playlist_path" {% if config.use_playlist_path %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="playlist_path_formatter">Playlist Path Formatter</label>
                    <input type="text" id="playlist_path_formatter" value="{{ config.playlist_path_formatter }}">
                </div>
                <div class="setting-row">
                    <label for="create_m3u_file">Create M3U File</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="create_m3u_file" {% if config.create_m3u_file %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="m3u_path_formatter">M3U Path Formatter</label>
                    <input type="text" id="m3u_path_formatter" value="{{ config.m3u_path_formatter }}">
                </div>
                <div class="setting-row">
                    <label for="extinf_separator">EXTINF Separator</label>
                    <input type="text" id="extinf_separator" value="{{ config.extinf_separator }}">
                </div>
                <div class="setting-row">
                    <label for="extinf_label">EXTINF Label</label>
                    <input type="text" id="extinf_label" value="{{ config.extinf_label }}">
                </div>
                <div class="setting-row">
                    <label for="save_album_cover">Save Album Cover</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="save_album_cover" {% if config.save_album_cover %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="album_cover_format">Album Cover Format</label>
                    <input type="text" id="album_cover_format" value="{{ config.album_cover_format }}">
                </div>
                <div class="setting-row">
                    <label for="file_bitrate">File Bitrate</label>
                    <input type="text" id="file_bitrate" value="{{ config.file_bitrate }}">
                </div>
                <div class="setting-row">
                    <label for="file_hertz">File Hertz</label>
                    <input type="number" id="file_hertz" value="{{ config.file_hertz }}">
                </div>
                <div class="setting-row">
                    <label for="use_custom_file_bitrate">Use Custom Bitrate</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="use_custom_file_bitrate" {% if config.use_custom_file_bitrate %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="translate_file_path">Translate File Path</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="translate_file_path" {% if config.translate_file_path %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Lyrics Section -->
        <div class="settings-section">
            <div class="section-header" onclick="toggleSection(this)">
                <h3>üìù Lyrics</h3>
                <div class="section-toggle">‚ñº</div>
            </div>
            <div class="section-content">
                <div class="setting-row">
                    <label for="download_lyrics">Download Lyrics</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="download_lyrics" {% if config.download_lyrics %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="only_download_synced_lyrics">Only Synced Lyrics</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="only_download_synced_lyrics" {% if config.only_download_synced_lyrics %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="only_download_plain_lyrics">Only Plain Lyrics</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="only_download_plain_lyrics" {% if config.only_download_plain_lyrics %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="save_lrc_file">Save LRC File</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="save_lrc_file" {% if config.save_lrc_file %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Audio Metadata Section -->
        <div class="settings-section">
            <div class="section-header collapsed" onclick="toggleSection(this)">
                <h3>üè∑Ô∏è Audio Metadata</h3>
                <div class="section-toggle">‚ñº</div>
            </div>
            <div class="section-content collapsed">
                <div class="setting-row">
                    <label for="metadata_separator">Metadata Separator</label>
                    <input type="text" id="metadata_separator" value="{{ config.metadata_separator }}">
                </div>
                <div class="setting-row">
                    <label for="overwrite_existing_metadata">Overwrite Existing</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="overwrite_existing_metadata" {% if config.overwrite_existing_metadata %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_branding">Embed Branding</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_branding" {% if config.embed_branding %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_cover">Embed Cover</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_cover" {% if config.embed_cover %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_artist">Embed Artist</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_artist" {% if config.embed_artist %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_album">Embed Album</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_album" {% if config.embed_album %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_albumartist">Embed Album Artist</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_albumartist" {% if config.embed_albumartist %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_name">Embed Name</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_name" {% if config.embed_name %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_year">Embed Year</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_year" {% if config.embed_year %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_discnumber">Embed Disc Number</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_discnumber" {% if config.embed_discnumber %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_tracknumber">Embed Track Number</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_tracknumber" {% if config.embed_tracknumber %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_genre">Embed Genre</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_genre" {% if config.embed_genre %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_performers">Embed Performers</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_performers" {% if config.embed_performers %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_producers">Embed Producers</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_producers" {% if config.embed_producers %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_writers">Embed Writers</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_writers" {% if config.embed_writers %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_label">Embed Label</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_label" {% if config.embed_label %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_copyright">Embed Copyright</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_copyright" {% if config.embed_copyright %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_description">Embed Description</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_description" {% if config.embed_description %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_language">Embed Language</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_language" {% if config.embed_language %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_isrc">Embed ISRC</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_isrc" {% if config.embed_isrc %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_length">Embed Length</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_length" {% if config.embed_length %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_url">Embed URL</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_url" {% if config.embed_url %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_key">Embed Key</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_key" {% if config.embed_key %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_bpm">Embed BPM</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_bpm" {% if config.embed_bpm %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_compilation">Embed Compilation</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_compilation" {% if config.embed_compilation %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_lyrics">Embed Lyrics</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_lyrics" {% if config.embed_lyrics %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_explicit">Embed Explicit</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_explicit" {% if config.embed_explicit %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_upc">Embed UPC</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_upc" {% if config.embed_upc %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_service_id">Embed Service ID</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_service_id" {% if config.embed_service_id %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_timesignature">Embed Time Signature</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_timesignature" {% if config.embed_timesignature %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_acousticness">Embed Acousticness</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_acousticness" {% if config.embed_acousticness %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_danceability">Embed Danceability</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_danceability" {% if config.embed_danceability %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_energy">Embed Energy</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_energy" {% if config.embed_energy %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_instrumentalness">Embed Instrumentalness</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_instrumentalness" {% if config.embed_instrumentalness %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_liveness">Embed Liveness</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_liveness" {% if config.embed_liveness %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_loudness">Embed Loudness</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_loudness" {% if config.embed_loudness %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_speechiness">Embed Speechiness</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_speechiness" {% if config.embed_speechiness %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="embed_valence">Embed Valence</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="embed_valence" {% if config.embed_valence %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Video Downloads Section -->
        <div class="settings-section">
            <div class="section-header collapsed" onclick="toggleSection(this)">
                <h3>üé¨ Video Downloads</h3>
                <div class="section-toggle">‚ñº</div>
            </div>
            <div class="section-content collapsed">
                <div class="setting-row">
                    <label for="video_download_path">Download Path</label>
                    <input type="text" id="video_download_path" value="{{ config.video_download_path }}">
                </div>
                <div class="setting-row">
                    <label for="movie_file_format">Movie File Format</label>
                    <input type="text" id="movie_file_format" value="{{ config.movie_file_format }}">
                </div>
                <div class="setting-row">
                    <label for="movie_path_formatter">Movie Path Formatter</label>
                    <input type="text" id="movie_path_formatter" value="{{ config.movie_path_formatter }}">
                </div>
                <div class="setting-row">
                    <label for="show_file_format">Show File Format</label>
                    <input type="text" id="show_file_format" value="{{ config.show_file_format }}">
                </div>
                <div class="setting-row">
                    <label for="show_path_formatter">Show Path Formatter</label>
                    <input type="text" id="show_path_formatter" value="{{ config.show_path_formatter }}">
                </div>
                <div class="setting-row">
                    <label for="preferred_video_resolution">Preferred Resolution</label>
                    <input type="number" id="preferred_video_resolution" value="{{ config.preferred_video_resolution }}">
                </div>
                <div class="setting-row">
                    <label for="download_subtitles">Download Subtitles</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="download_subtitles" {% if config.download_subtitles %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="preferred_audio_language">Preferred Audio Language</label>
                    <input type="text" id="preferred_audio_language" value="{{ config.preferred_audio_language }}">
                </div>
                <div class="setting-row">
                    <label for="preferred_subtitle_language">Preferred Subtitle Language</label>
                    <input type="text" id="preferred_subtitle_language" value="{{ config.preferred_subtitle_language }}">
                </div>
                <div class="setting-row">
                    <label for="download_all_available_audio">Download All Audio Tracks</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="download_all_available_audio" {% if config.download_all_available_audio %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label for="download_all_available_subtitles">Download All Subtitles</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="download_all_available_subtitles" {% if config.download_all_available_subtitles %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <div class="mobile-save-bar">
        <button onclick="saveAllSettings()">Save Settings</button>
    </div>

    <script>
        function toggleSection(header) {
            header.classList.toggle('collapsed');
            header.nextElementSibling.classList.toggle('collapsed');
        }

        function saveAllSettings() {
            // Get the save button (either desktop or mobile)
            const saveButton = event ? event.target : document.querySelector('.btn-save');
            if (!saveButton) return;

            // Add visual feedback
            const originalText = saveButton.textContent.trim();
            saveButton.disabled = true;
            saveButton.classList.add('button-loading');

            // Find the span inside the button (desktop) or use button directly (mobile)
            const buttonSpan = saveButton.querySelector('span');
            if (buttonSpan) {
                buttonSpan.textContent = 'Saving...';
            } else {
                saveButton.textContent = 'Saving...';
            }

            // Save settings
            updateSettings(returnSettingsData());

            // Show success feedback after a short delay
            setTimeout(() => {
                saveButton.disabled = false;
                saveButton.classList.remove('button-loading');
                saveButton.classList.add('button-clicked');

                if (buttonSpan) {
                    buttonSpan.textContent = 'Saved!';
                } else {
                    saveButton.textContent = 'Saved!';
                }

                showToast('Settings saved successfully!', 'success');

                // Reset button after animation
                setTimeout(() => {
                    saveButton.classList.remove('button-clicked');
                    if (buttonSpan) {
                        buttonSpan.textContent = 'Save Settings';
                    } else {
                        saveButton.textContent = 'Save Settings';
                    }
                }, 1000);
            }, 500);
        }

        function returnSettingsData() {
            const activeAccountNumber = document.querySelector('input[name="active_account_number"]:checked');
            return {
                active_account_number: activeAccountNumber ? activeAccountNumber.value : '',
                use_webui_login: document.getElementById('use_webui_login').checked,
                use_plex_login: document.getElementById('use_plex_login').checked,
                require_plex_server_access: document.getElementById('require_plex_server_access').checked,
                webui_username: document.getElementById('webui_username').value,
                webui_password: document.getElementById('webui_password').value,
                plex_server_url: document.getElementById('plex_server_url').value,
                plex_auth_token: document.getElementById('plex_auth_token').value,
                plex_library_section_id: document.getElementById('plex_library_section_id').value,
                explicit_label: document.getElementById('explicit_label').value,
                download_copy_btn: document.getElementById('download_copy_btn').checked,
                download_open_btn: document.getElementById('download_open_btn').checked,
                download_locate_btn: document.getElementById('download_locate_btn').checked,
                download_delete_btn: document.getElementById('download_delete_btn').checked,
                show_search_thumbnails: document.getElementById('show_search_thumbnails').checked,
                show_download_thumbnails: document.getElementById('show_download_thumbnails').checked,
                thumbnail_size: document.getElementById('thumbnail_size').value,
                max_search_results: document.getElementById('max_search_results').value,
                disable_download_popups: document.getElementById('disable_download_popups').checked,
                windows_10_explorer_thumbnails: document.getElementById('windows_10_explorer_thumbnails').checked,
                mirror_spotify_playback: document.getElementById('mirror_spotify_playback').checked,
                close_to_tray: document.getElementById('close_to_tray').checked,
                check_for_updates: document.getElementById('check_for_updates').checked,
                illegal_character_replacement: document.getElementById('illegal_character_replacement').value,
                raw_media_download: document.getElementById('raw_media_download').checked,
                rotate_active_account_number: document.getElementById('rotate_active_account_number').checked,
                download_delay: document.getElementById('download_delay').value,
                download_chunk_size: document.getElementById('download_chunk_size').value,
                maximum_queue_workers: document.getElementById('maximum_queue_workers').value,
                maximum_download_workers: document.getElementById('maximum_download_workers').value,
                enable_retry_worker: document.getElementById('enable_retry_worker').checked,
                retry_worker_delay: document.getElementById('retry_worker_delay').value,
                audio_download_path: document.getElementById('audio_download_path').value,
                track_file_format: document.getElementById('track_file_format').value,
                track_path_formatter: document.getElementById('track_path_formatter').value,
                podcast_file_format: document.getElementById('podcast_file_format').value,
                podcast_path_formatter: document.getElementById('podcast_path_formatter').value,
                use_playlist_path: document.getElementById('use_playlist_path').checked,
                playlist_path_formatter: document.getElementById('playlist_path_formatter').value,
                create_m3u_file: document.getElementById('create_m3u_file').checked,
                m3u_path_formatter: document.getElementById('m3u_path_formatter').value,
                extinf_separator: document.getElementById('extinf_separator').value,
                extinf_label: document.getElementById('extinf_label').value,
                save_album_cover: document.getElementById('save_album_cover').checked,
                album_cover_format: document.getElementById('album_cover_format').value,
                file_bitrate: document.getElementById('file_bitrate').value,
                file_hertz: document.getElementById('file_hertz').value,
                use_custom_file_bitrate: document.getElementById('use_custom_file_bitrate').checked,
                download_lyrics: document.getElementById('download_lyrics').checked,
                only_download_synced_lyrics: document.getElementById('only_download_synced_lyrics').checked,
                only_download_plain_lyrics: document.getElementById('only_download_plain_lyrics').checked,
                save_lrc_file: document.getElementById('save_lrc_file').checked,
                translate_file_path: document.getElementById('translate_file_path').checked,
                metadata_separator: document.getElementById('metadata_separator').value,
                overwrite_existing_metadata: document.getElementById('overwrite_existing_metadata').checked,
                embed_branding: document.getElementById('embed_branding').checked,
                embed_cover: document.getElementById('embed_cover').checked,
                embed_artist: document.getElementById('embed_artist').checked,
                embed_album: document.getElementById('embed_album').checked,
                embed_albumartist: document.getElementById('embed_albumartist').checked,
                embed_name: document.getElementById('embed_name').checked,
                embed_year: document.getElementById('embed_year').checked,
                embed_discnumber: document.getElementById('embed_discnumber').checked,
                embed_tracknumber: document.getElementById('embed_tracknumber').checked,
                embed_genre: document.getElementById('embed_genre').checked,
                embed_performers: document.getElementById('embed_performers').checked,
                embed_producers: document.getElementById('embed_producers').checked,
                embed_writers: document.getElementById('embed_writers').checked,
                embed_label: document.getElementById('embed_label').checked,
                embed_copyright: document.getElementById('embed_copyright').checked,
                embed_description: document.getElementById('embed_description').checked,
                embed_language: document.getElementById('embed_language').checked,
                embed_isrc: document.getElementById('embed_isrc').checked,
                embed_length: document.getElementById('embed_length').checked,
                embed_url: document.getElementById('embed_url').checked,
                embed_key: document.getElementById('embed_key').checked,
                embed_bpm: document.getElementById('embed_bpm').checked,
                embed_compilation: document.getElementById('embed_compilation').checked,
                embed_lyrics: document.getElementById('embed_lyrics').checked,
                embed_explicit: document.getElementById('embed_explicit').checked,
                embed_upc: document.getElementById('embed_upc').checked,
                embed_service_id: document.getElementById('embed_service_id').checked,
                embed_timesignature: document.getElementById('embed_timesignature').checked,
                embed_acousticness: document.getElementById('embed_acousticness').checked,
                embed_danceability: document.getElementById('embed_danceability').checked,
                embed_energy: document.getElementById('embed_energy').checked,
                embed_instrumentalness: document.getElementById('embed_instrumentalness').checked,
                embed_liveness: document.getElementById('embed_liveness').checked,
                embed_loudness: document.getElementById('embed_loudness').checked,
                embed_speechiness: document.getElementById('embed_speechiness').checked,
                embed_valence: document.getElementById('embed_valence').checked,
                video_download_path: document.getElementById('video_download_path').value,
                movie_file_format: document.getElementById('movie_file_format').value,
                movie_path_formatter: document.getElementById('movie_path_formatter').value,
                show_file_format: document.getElementById('show_file_format').value,
                show_path_formatter: document.getElementById('show_path_formatter').value,
                preferred_video_resolution: document.getElementById('preferred_video_resolution').value,
                download_subtitles: document.getElementById('download_subtitles').checked,
                preferred_audio_language: document.getElementById('preferred_audio_language').value,
                preferred_subtitle_language: document.getElementById('preferred_subtitle_language').value,
                download_all_available_audio: document.getElementById('download_all_available_audio').checked,
                download_all_available_subtitles: document.getElementById('download_all_available_subtitles').checked,
            };
        }

        function handleServiceChange() {
            const service = document.getElementById('login_services').value;
            const username = document.getElementById('login_username');
            const password = document.getElementById('login_password');
            const button = document.getElementById('login_button');
            const notice = document.getElementById('login_notice');

            username.style.display = 'none';
            password.style.display = 'none';
            button.style.display = 'block';
            notice.style.display = 'none';

            switch(service) {
                case 'apple_music':
                    password.style.display = 'block';
                    password.placeholder = 'Enter your user-media-token';
                    button.textContent = 'Add Account';
                    break;
                case 'bandcamp':
                    button.textContent = 'Add Public Bandcamp Account';
                    break;
                case 'deezer':
                    password.style.display = 'block';
                    password.placeholder = 'Enter your arl';
                    button.textContent = 'Add Account';
                    break;
                case 'qobuz':
                case 'crunchyroll':
                    username.style.display = 'block';
                    username.placeholder = 'Enter your email';
                    password.style.display = 'block';
                    password.placeholder = 'Enter your password';
                    button.textContent = 'Add Account';
                    break;
                case 'soundcloud':
                    password.style.display = 'block';
                    password.placeholder = 'Enter your oauth-token';
                    button.textContent = 'Add Account';
                    break;
                case 'spotify':
                case 'tidal':
                    button.style.display = 'none';
                    notice.style.display = 'block';
                    notice.textContent = 'Logins for this service are not currently supported. Please login through the desktop app.';
                    break;
                case 'youtube_music':
                    button.textContent = 'Add Public Youtube Music Account';
                    break;
                case 'generic':
                    button.textContent = 'Add Generic Account';
                    break;
            }
        }

        function addAccount() {
            const data = {
                service: document.getElementById('login_services').value,
                username: document.getElementById('login_username').value,
                password: document.getElementById('login_password').value
            };
            fetch('/api/add_account', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(r => r.json())
            .then(() => { alert('Account added! Please restart.'); location.reload(); })
            .catch(e => console.error(e));
        }

        function removeAccount(uuid) {
            if (!confirm('Remove this account?')) return;
            fetch('/api/remove_account/' + uuid, { method: 'DELETE' })
            .then(r => { if (r.ok) { alert('Account removed! Please restart.'); location.reload(); } });
        }

        handleServiceChange();
    </script>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <span class="toast-icon"></span>
        <span class="toast-message"></span>
    </div>
</body>
</html>
